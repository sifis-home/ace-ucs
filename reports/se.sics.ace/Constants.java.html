<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>Constants.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">ACE library</a> &gt; <a href="index.source.html" class="el_package">se.sics.ace</a> &gt; <span class="el_source">Constants.java</span></div><h1>Constants.java</h1><pre class="source lang-java linenums">/*******************************************************************************
 * Copyright (c) 2019, RISE AB
 * All rights reserved.
 *
 * Redistribution and use in source and binary forms, with or without 
 * modification, are permitted provided that the following conditions 
 * are met:
 *
 * 1. Redistributions of source code must retain the above copyright notice, 
 *    this list of conditions and the following disclaimer.
 *
 * 2. Redistributions in binary form must reproduce the above copyright notice, 
 *    this list of conditions and the following disclaimer in the documentation 
 *    and/or other materials provided with the distribution.
 *
 * 3. Neither the name of the copyright holder nor the names of its
 *    contributors may be used to endorse or promote products derived from
 *    this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS 
 * &quot;AS IS&quot; AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT 
 * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR 
 * A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT 
 * HOLDER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, 
 * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT 
 * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, 
 * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY 
 * THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT 
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE 
 * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 *******************************************************************************/
package se.sics.ace;

import java.nio.charset.Charset;
import java.util.HashMap;
import java.util.HashSet;
import java.util.Map;
import java.util.Set;

import com.upokecenter.cbor.CBORObject;
import com.upokecenter.cbor.CBORType;

import COSE.AlgorithmID;

/**
 * Constants for use with the ACE framework.
 * 
 * @author Ludwig Seitz and Marco Tiloca
 *
 */
<span class="nc" id="L51">public class Constants {</span>
	
    /**
     * Charset for this library
     */
<span class="fc" id="L56">    public static final Charset charset = Charset.forName(&quot;UTF-8&quot;);</span>
    
    
    /**
     * AS Request Creation Hints  ========================================================
     */
    
    /**
     * The authorization server address
     */
    public static final short AS = 1; // Major type 3 (text string)
   
    /**
     * The key identifier
     */
    public static final short KID = 2;
    
    //AUDIENCE = 5 as defined for the token endpoint parameters
    
    //SCOPE = 9 as defined for the token endpoint parameters
    
    //CNONCE = 39 as defined for the token endpoint parameters
    
    /**
     * Abbreviations for OAuth error codes ====================================
     */
    
    /**
     * The request is missing a required parameter, includes an
     * unsupported parameter value (other than grant type),
     * repeats a parameter, includes multiple credentials,
     * utilizes more than one mechanism for authenticating the
     * client, or is otherwise malformed.
     */
    public static final short INVALID_REQUEST = 1;
    
    /**
     * Client authentication failed
     */
    public static final short INVALID_CLIENT = 2;
    
    /**
     * The provided authorization grant or refresh token is
     * invalid, expired, revoked, does not match the redirection
     * URI used in the authorization request, or was issued to
     * another client.
     */ 
    public static final short INVALID_GRANT = 3;
    
    /**
     * The authenticated client is not authorized to use this
     * authorization grant type.
     */
    public static final short UNAUTHORIZED_CLIENT = 4;
    
    /**
     *  The authorization grant type is not supported by the
     *  authorization server.
     */
    public static final short UNSUPPORTED_GRANT_TYPE = 5;
    
    /**
     * The requested scope is invalid, unknown, malformed, or
     * exceeds the scope granted by the resource owner.
     */
    public static final short INVALID_SCOPE = 6;
    
    /**
     * The RS does not support the requestest pop key type
     */
    public static final short UNSUPPORTED_POP_KEY = 7;
    
    /**
     * The client and the RS do not share a common profile
     */
    public static final short INCOMPATIBLE_PROFILES = 8;
    
    /**
     * The string values for these abbreviations
     */
<span class="fc" id="L136">    public static final String[] ERROR_CODES </span>
        = {&quot;&quot;, &quot;invalid_request&quot;, &quot;invalid_client&quot;, &quot;invalid_grant&quot;, 
                &quot;unauthorized_client&quot;, &quot;unsupported_grant_type&quot;, 
                &quot;invalid_scope&quot;, &quot;unsupported_pop_key&quot;, 
                &quot;incompatible_profiles&quot;};
    
    
    
    /**
     * Abbreviations for OAuth grant types ====================================
     */
    
    /**
     * grant type password  
     */
    public static final short GT_PASSWORD = 0;
    
    /**
     * grant type authorization code
     */
    public static final short GT_AUTHZ_CODE = 1;
    
    /**
     * grant type client credentials
     */
    public static final short GT_CLI_CRED = 2;
    
    /**
     * grant type refresh token
     */
    public static final short GT_REF_TOK = 3;
    
    
    
    
    
	/** 
	 * OAuth token endpoint abbreviations =====================================
	 */
    
    /**
     * The access token
     */
    public static final short ACCESS_TOKEN = 1; // 3
    
    /**
     * The time when this token expires (in Epoch time)
     */
    public static final short EXPIRES_IN = 2; // 0
    
    /**
     * The requested public key for proof-of-possession
     */
    public static final short REQ_CNF = 4;
        
    /**
     * The requested audience of an access token
     */
    public static final short AUDIENCE = 5;
        
    /**
     * The proof-of-possession key selected by the AS
     */
    public static final short CNF = 8; //Major type 5 (map)
      
    /**
     * The scope of an access token
     */
    public static final short SCOPE = 9; //3
    
 
    /**
     * The client identifier in a token request
     */
    public static final short CLIENT_ID = 24; //3
    
    /**
     * The client password in a token request for certain grant types
     */
    public static final short CLIENT_SECRET = 25; //2
   
    /**
     * The response type (see 
     * https://www.iana.org/assignments/oauth-parameters/oauth-parameters.xhtml#endpoint)
     */
    public static final short RESPONSE_TYPE = 26; //3
    
    /**
     * The redirect URI
     */
    public static final short REDIRECT_URI = 27; //3  
    
    /**
     * An opaque value used by the client to maintain
     *    state between the request and callback. 
     */
    public static final short STATE = 28; //3
    
    /**
     * The authorization code generated by the
     *   authorization server.
     */
    public static final short CODE = 29; //2
    
    /**
     * The error code
     */
    public static final short ERROR = 30; //0
    
    /**
     * Human-readable ASCII text providing
     *    additional information on an error
     */
    public static final short ERROR_DESCRIPTION = 31; //3
    
    /**
     * A URI identifying a human-readable web page with
     * information about the error,
     */
    public static final short ERROR_URI = 32; //3
    
    /**
     * The grant type (e.g. &quot;client_credentials&quot;)
     */
    public static final short GRANT_TYPE = 33;// Major type 0 (uint)
       
    /**
     * The type of the access token, e.g. &quot;pop&quot; or &quot;bearer&quot;
     */
    public static final short TOKEN_TYPE = 34; // 0
    
    /**
     * The username, for a username/password grant
     */
    public static final short USERNAME = 35; //3
    
    /**
     * The password, for a username/password grant
     */
    public static final short PASSWORD = 36; //3
    
    /**
     * The refresh token
     */
    public static final short REFRESH_TOKEN = 37; //3
        
    /**
     * The profile to be used between client and RS
     */
    public static final short PROFILE = 38; //0
            
    /**
     * The client nonce obtained from the AS Request Creation Hints
     */
    public static final short CNONCE = 39;
    
    /**
     * The public key of the RS
     */
    public static final short RS_CNF = 41;
    
    
    /** 
     * OAuth introspection endpoint abbreviations =============================
     */
    
    /**
     * The issuer of an access token
     */
	public static final short ISS = 1; // Major type 3 (text string)
	
	/**
	 * The subject of an access token
	 */
	public static final short SUB = 2; //3
	
	/**
	 * The audience of an access token
	 */
	public static final short AUD = 3; //3
	
	/**
	 * The expiration time of an access token
	 * (in Epoch time)
	 */
	public static final short EXP = 4; // MT 6 tag 1 (Epoch-based date/time)
	
	/**
	 * The &quot;not before&quot; time of an access token (in Epoch time)
	 */
	public static final short NBF = 5; // 6t1
	
	/**
	 * The time an access token was issues (in Epoch time)
	 */
	public static final short IAT = 6; // 6t1
	
	/**
	 * The access token identifier
	 */
	public static final short CTI = 7; // Major type 2 (byte string)
	
	//cnf = 8  	
    //scope = 9
	
    /**
     * A boolean indicating if a token is active in an introspection response
     */
    public static final short ACTIVE = 10; // boolean
    
    /**
     * The token in an introspection request
     */
    public static final short TOKEN = 11; // 3
  	
    //client_id = 24
	//error = 30
	//error_description = 31
	//error_uri = 32

	/**
	 * A hint for the AS about the type of token in an introspection request
	 */
	public static final short TOKEN_TYPE_HINT = 33; //3
	
	//token_type = 34
	//username = 35
		
	//profile = 38  
	//cnonce = 39
	//rs_cnf = 40

    /**
     * The expiration of the token in seconds from when it first was seen by the RS.
     */
    public static final short EXI = 40; //0
	
	/**
	 * CWT claims abbreviations ===============================================
	 */
    
    /**
     * Abbreviation for the sentinel claim used only for token storage at the AS.
     * That is, this claim is not included in the access token sent on the wire.
     * 
     * In case of introspection, this claim signals that the EXP claim has been
     * added after the actual creation of the access token, if this was initially
     * created with the EXI claim but without the EXP claim.
     * 
     * The &quot;sentinel claim&quot; has CBOR abbreviation 0, which is reserved.
     * A value smaller than -65536 (&quot;private use&quot;) would be more appropriate,
     * but it would not be representable through the short integer type already
     * used for the keys in the maps encoding claim sets.
     */
	public static final short LATE_ADDED_EXP = 0;
    
	//iss = 1
	//sub = 2
	//aud = 3
	//exp = 4
	//nbf = 5
	//iat = 6
	//cti = 7
	//cnf = 8
	//scope = 9
	//profile = 38
    //cnonce = 39
	//rs_cnf = 40
    //exi = 40

   /**
    * Token type abbreviations ================================================
    */
	
	/**
	 * Abbreviation identifying a bearer token
	 */
	public static final short BEARER = 1;
	
	/**
	 * Abbreviation identifying a proof-of-possession token
	 */	
	public static final short POP = 2;


	/**
	 * Authz-Info error abbreviations ========================================
	 */
	//invalid request = 1

	/**
	 * The access token provided is expired, revoked, malformed, or
	 *  invalid for other reasons. 
	 */
	public static final short INVALID_TOKEN = 9; 

	/**
	 * The request requires higher privileges than provided by 
	 * the access token.
	 */
	public static final short INSUFFICIENT_SCOPE = 10;


	/**
	 * OSCORE_Input_Material abbreviations =================================
	 */  

	/**
	 * The outer map key of a OSCORE_Input_Material object
	 * Specified in RFC9203
	 */
<span class="fc" id="L447">	public static final CBORObject OSCORE_Input_Material</span>
<span class="fc" id="L448">	    = CBORObject.FromObject(4);</span>

    /**
     * The input material identifier
     */
<span class="fc" id="L453">    public static final CBORObject OS_ID = CBORObject.FromObject(0);</span>
	
	/**
	 * The version
	 */
<span class="fc" id="L458">	public static final CBORObject OS_VERSION = CBORObject.FromObject(1);</span>
	
	/**
	 * The master secret
	 */
<span class="fc" id="L463">	public static final CBORObject OS_MS = CBORObject.FromObject(2);</span>
	
    /**
     * The HKDF algorithm
     */
<span class="fc" id="L468">    public static final CBORObject OS_HKDF = CBORObject.FromObject(3);</span>

    /**
     * The AEAD algorithm
     */
<span class="fc" id="L473">    public static final CBORObject OS_ALG = CBORObject.FromObject(4);</span>

    /**
     * The Master Salt
     */
<span class="fc" id="L478">    public static final CBORObject OS_SALT = CBORObject.FromObject(5);</span>
    
    /**
     * The Id Context
     */
<span class="fc" id="L483">    public static final CBORObject OS_CONTEXTID = CBORObject.FromObject(6);</span>
    
	/**
	 * The client Id
	 */
<span class="fc" id="L488">	public static final CBORObject OS_CLIENTID = CBORObject.FromObject(-65537);</span>

	/**
	 * The server Id
	 */
<span class="fc" id="L493">	public static final CBORObject OS_SERVERID = CBORObject.FromObject(-65538);</span>


    /**
     * Default value for alg
     */
<span class="fc" id="L499">    public static final short OS_DEFAULT_ALG </span>
<span class="fc" id="L500">        = AlgorithmID.AES_CCM_16_64_128.AsCBOR().AsNumber().ToInt16Checked();</span>

    
    /**
     * Default value for hkdf
     */
<span class="fc" id="L506">    public static final short OS_DEFAULT_HKDF </span>
<span class="fc" id="L507">        = AlgorithmID.HMAC_SHA_256.AsCBOR().AsNumber().ToInt16Checked();</span>
    
	/**
	 * RESTful action names ===================================================
	 */
<span class="fc" id="L512">	public static final String[] RESTACTIONS </span>
	= {&quot;GET&quot;, &quot;POST&quot;, &quot;PUT&quot;, &quot;DELETE&quot;};


	/**
	 * Abbreviations for the cnf parameter/claim ==============================
	 */

	/**
	 * A cnf containing a COSE_Key
	 */
	public static final short COSE_KEY = 1;

    /**
     * ... same as above as CBORObject
     */
<span class="fc" id="L528">    public static final CBORObject COSE_KEY_CBOR </span>
<span class="fc" id="L529">        = CBORObject.FromObject(COSE_KEY);	</span>
	
	/**
	 * A cnf containing a COSE_Encrypted wrapping a COSE_Key
	 */
	public static final short COSE_ENCRYPTED = 2;
	
	/**
     * ... same as above as CBORObject
     */
<span class="fc" id="L539">    public static final CBORObject COSE_ENCRYPTED_CBOR </span>
<span class="fc" id="L540">        = CBORObject.FromObject(COSE_ENCRYPTED);</span>
	
	/**
	 * A cnf containing just a key identifier
	 */
	public static final short COSE_KID = 3;
	
    /**
     * ... same as above as CBORObject
     */
<span class="fc" id="L550">    public static final CBORObject COSE_KID_CBOR </span>
<span class="fc" id="L551">        = CBORObject.FromObject(COSE_KID);</span>
    

    /**
     * Searches an array of strings for the index of the given string.
     * @param array  an array of Strings
     * @param val  a String value
     * @return  the index of val in array
     */
    public static short getIdx(String[] array, String val) {
<span class="nc bnc" id="L561" title="All 4 branches missed.">        if (val == null || array == null) {</span>
<span class="nc" id="L562">            return -1;</span>
        }
<span class="nc bnc" id="L564" title="All 2 branches missed.">        for (short i=0; i&lt;array.length; i++) {</span>
<span class="nc bnc" id="L565" title="All 2 branches missed.">            if (val.equals(array[i])) {</span>
<span class="nc" id="L566">                return i;</span>
            }
        }
<span class="nc" id="L569">        return -1;</span>
    }
    
    /**
     * Takes a CBORObject that is a map and transforms it
     * into Map&lt;Short, CBORObject&gt;
     * @param cbor  the CBOR map
     * @return  the Map
     * @throws AceException if the cbor parameter is not a CBOR map or
     *  if a key is not a short
     */
    public static Map&lt;Short, CBORObject&gt; getParams(CBORObject cbor) 
            throws AceException {
<span class="pc bpc" id="L582" title="1 of 2 branches missed.">        if (!cbor.getType().equals(CBORType.Map)) {</span>
<span class="nc" id="L583">            throw new AceException(&quot;CBOR object is not a Map&quot;); </span>
        }
<span class="fc" id="L585">        Map&lt;Short, CBORObject&gt; ret = new HashMap&lt;&gt;();</span>
<span class="fc bfc" id="L586" title="All 2 branches covered.">        for (CBORObject key : cbor.getKeys()) {</span>
<span class="pc bpc" id="L587" title="1 of 2 branches missed.">            if (!key.getType().equals(CBORType.Integer)) {</span>
<span class="nc" id="L588">                throw new AceException(&quot;CBOR key was not a Short: &quot;</span>
<span class="nc" id="L589">                        + key.toString());</span>
            }
<span class="fc" id="L591">            ret.put(key.AsNumber().ToInt16Checked(), cbor.get(key));</span>
<span class="fc" id="L592">        }</span>
<span class="fc" id="L593">        return ret;</span>
    }
    
    /**
     * Takes a  Map&lt;Short, CBORObject&gt; and transforms it into a CBOR map.
     * 
     * @param map  the map
     * @return  the CBOR map
     */
    public static CBORObject getCBOR(Map&lt;Short, CBORObject&gt; map) {
<span class="fc" id="L603">        CBORObject cbor = CBORObject.NewMap();</span>
<span class="fc bfc" id="L604" title="All 2 branches covered.">        for (Map.Entry&lt;Short, CBORObject&gt; e : map.entrySet()) {</span>
<span class="fc" id="L605">            cbor.Add(e.getKey(), e.getValue());</span>
<span class="fc" id="L606">        }</span>
<span class="fc" id="L607">        return cbor;</span>
    }
    
    /**
     * The string values for the grant type abbreviations (use for debugging)
     */
<span class="fc" id="L613">    public static final String[] GRANT_TYPES = {&quot;password&quot;, </span>
            &quot;authorization_code&quot;, &quot;client_credentials&quot;, &quot;refresh_token&quot;};

    /**
     * Value for the label &quot;nonce1&quot; in the Token POST request for the OSCORE profile
     */
    public static final short NONCE1 = 40;
    
    /**
     * Value for the label &quot;nonce2&quot; in the Token POST request for the OSCORE profile
     */
    public static final short NONCE2 = 42;
    
    /**
     * Value for the label &quot;ace_client_recipientid&quot; in the Token POST request for the OSCORE profile
     */
    public static final short ACE_CLIENT_RECIPIENTID = 43;
    
    /**
     * Value for the label &quot;ace_server_recipientid&quot; in the Token POST request for the OSCORE profile
     */
    public static final short ACE_SERVER_RECIPIENTID = 44;
    
    /**
     * Value for the label &quot;sign_info&quot; in the Token POST request/response with Content-Format application/ace+cbor
     */
    public static final short SIGN_INFO = 90;

    /**
     * Value for the label &quot;kdcchallenge&quot; in the Token POST request/response with Content-Format application/ace+cbor
     */
    public static final short KDCCHALLENGE = 91;

    /**
     * Value for the label &quot;ecdh_info&quot; in the Token POST request/response with Content-Format application/ace+cbor
     */
    public static final short ECDH_INFO = 92;

    /**
     * Value for the label &quot;kdc_dh_creds&quot; in the Token POST request/response with Content-Format application/ace+cbor
     */
    public static final short KDC_DH_CREDS = 93;



    /**
     * The abbreviation code for the DTLS profile, as value of the ace_profile parameter/claim
     */
    public static final short COAP_DTLS = 1;

    /**
     * The abbreviation code for the OSCORE profile, as value of the ace_profile parameter/claim
     */
    public static final short COAP_OSCORE = 2;

    /**
     * Return the abbreviated profile id for the full profile name.
     * 
     * @param profileStr  profile name
     * @return  the abbreviation
     */
    public static short getProfileAbbrev(String profileStr) {
<span class="fc bfc" id="L675" title="All 2 branches covered.">        if (profileStr.equals(&quot;coap_dtls&quot;)) {</span>
<span class="fc" id="L676">            return COAP_DTLS;</span>
<span class="pc bpc" id="L677" title="1 of 2 branches missed.">        } else if (profileStr.equals(&quot;coap_oscore&quot;)) {</span>
<span class="fc" id="L678">            return COAP_OSCORE;</span>
        } else {
<span class="nc" id="L680">            return -1;</span>
        }
    }
    
    /**
     * Array of the human readable names for AS Request Creation Hints 
     * parameters.
     */
<span class="fc" id="L688">    public static String[] ABBREV_HINTS = new String[42];</span>
    static {
<span class="fc" id="L690">        ABBREV_HINTS[1] = &quot;AS&quot;;</span>
<span class="fc" id="L691">        ABBREV_HINTS[2] = &quot;kid&quot;;</span>
<span class="fc" id="L692">        ABBREV_HINTS[5] = &quot;audience&quot;;</span>
<span class="fc" id="L693">        ABBREV_HINTS[9] = &quot;scope&quot;;</span>
<span class="fc" id="L694">        ABBREV_HINTS[39] = &quot;cnonce&quot;;</span>
    }
    
    /**
     * Array of the human readable names for the token parameters.
     */
<span class="fc" id="L700">    public static String[] ABBREV_TOKEN = new String[42];</span>
    static {
<span class="fc" id="L702">        ABBREV_TOKEN[1] = &quot;access_token&quot;; </span>
<span class="fc" id="L703">        ABBREV_TOKEN[2] = &quot;expires_in&quot;; </span>
<span class="fc" id="L704">        ABBREV_TOKEN[4] = &quot;req_cnf&quot;; </span>
<span class="fc" id="L705">        ABBREV_TOKEN[5] = &quot;audience&quot;; </span>
<span class="fc" id="L706">        ABBREV_TOKEN[8] = &quot;cnf&quot;; </span>
<span class="fc" id="L707">        ABBREV_TOKEN[9] = &quot;scope&quot;; </span>
<span class="fc" id="L708">        ABBREV_TOKEN[24] = &quot;client_id&quot;; </span>
<span class="fc" id="L709">        ABBREV_TOKEN[25] = &quot;client_secret&quot;; </span>
<span class="fc" id="L710">        ABBREV_TOKEN[26] = &quot;response_type&quot;; </span>
<span class="fc" id="L711">        ABBREV_TOKEN[27] = &quot;redirect_uri&quot;; </span>
<span class="fc" id="L712">        ABBREV_TOKEN[28] = &quot;state&quot;; </span>
<span class="fc" id="L713">        ABBREV_TOKEN[29] = &quot;code&quot;;</span>
<span class="fc" id="L714">        ABBREV_TOKEN[30] = &quot;error&quot;; </span>
<span class="fc" id="L715">        ABBREV_TOKEN[31] = &quot;error_description&quot;; </span>
<span class="fc" id="L716">        ABBREV_TOKEN[32] = &quot;error_uri&quot;; </span>
<span class="fc" id="L717">        ABBREV_TOKEN[33] = &quot;grant_type&quot;; </span>
<span class="fc" id="L718">        ABBREV_TOKEN[34] = &quot;token_type&quot;; </span>
<span class="fc" id="L719">        ABBREV_TOKEN[35] = &quot;username&quot;; </span>
<span class="fc" id="L720">        ABBREV_TOKEN[36] = &quot;password&quot;; </span>
<span class="fc" id="L721">        ABBREV_TOKEN[37] = &quot;refresh_token&quot;; </span>
<span class="fc" id="L722">        ABBREV_TOKEN[38] = &quot;profile&quot;; </span>
<span class="fc" id="L723">        ABBREV_TOKEN[39] = &quot;cnonce&quot;; </span>
<span class="fc" id="L724">        ABBREV_TOKEN[41] = &quot;rs_cnf&quot;;</span>
    }
    
    /**
     * Array of the human readable names for the introspect parameters.
     */
<span class="fc" id="L730">    public static String[] ABBREV_INTROSPECT = new String[42];</span>
    static {
<span class="fc" id="L732">        ABBREV_INTROSPECT[1] = &quot;iss&quot;; </span>
<span class="fc" id="L733">        ABBREV_INTROSPECT[2] = &quot;sub&quot;; </span>
<span class="fc" id="L734">        ABBREV_INTROSPECT[3] = &quot;aud&quot;;</span>
<span class="fc" id="L735">        ABBREV_INTROSPECT[4] = &quot;exp&quot;; </span>
<span class="fc" id="L736">        ABBREV_INTROSPECT[5] = &quot;nbf&quot;; </span>
<span class="fc" id="L737">        ABBREV_INTROSPECT[6] = &quot;iat&quot;;</span>
<span class="fc" id="L738">        ABBREV_INTROSPECT[7] = &quot;cti&quot;; </span>
<span class="fc" id="L739">        ABBREV_INTROSPECT[8] = &quot;cnf&quot;; </span>
<span class="fc" id="L740">        ABBREV_INTROSPECT[9] = &quot;scope&quot;;</span>
<span class="fc" id="L741">        ABBREV_INTROSPECT[10] = &quot;active&quot;; </span>
<span class="fc" id="L742">        ABBREV_INTROSPECT[11] = &quot;token&quot;; </span>
<span class="fc" id="L743">        ABBREV_INTROSPECT[24] = &quot;client_id&quot;; </span>
<span class="fc" id="L744">        ABBREV_INTROSPECT[30] = &quot;error&quot;; </span>
<span class="fc" id="L745">        ABBREV_INTROSPECT[31] = &quot;error_description&quot;; </span>
<span class="fc" id="L746">        ABBREV_INTROSPECT[32] = &quot;error_uri&quot;; </span>
<span class="fc" id="L747">        ABBREV_INTROSPECT[33] = &quot;token_type_hint&quot;; </span>
<span class="fc" id="L748">        ABBREV_INTROSPECT[34] = &quot;token_type&quot;; </span>
<span class="fc" id="L749">        ABBREV_INTROSPECT[35] = &quot;username&quot;; </span>
<span class="fc" id="L750">        ABBREV_INTROSPECT[38] = &quot;profile&quot;; </span>
<span class="fc" id="L751">        ABBREV_INTROSPECT[39] = &quot;cnonce&quot;;</span>
<span class="fc" id="L752">        ABBREV_INTROSPECT[40] = &quot;exi&quot;;</span>
<span class="fc" id="L753">        ABBREV_INTROSPECT[41] = &quot;rs_cnf&quot;;</span>
    }
    
    /**
     * Array of the human readable names for the CWT claims
     */
<span class="fc" id="L759">    public static String[] ABBREV_CWT = new String[42];</span>
    static {
<span class="fc" id="L761">        ABBREV_CWT[1] = &quot;iss&quot;; </span>
<span class="fc" id="L762">        ABBREV_CWT[2] = &quot;sub&quot;; </span>
<span class="fc" id="L763">        ABBREV_CWT[3] = &quot;aud&quot;;</span>
<span class="fc" id="L764">        ABBREV_CWT[4] = &quot;exp&quot;; </span>
<span class="fc" id="L765">        ABBREV_CWT[5] = &quot;nbf&quot;; </span>
<span class="fc" id="L766">        ABBREV_CWT[6] = &quot;iat&quot;;</span>
<span class="fc" id="L767">        ABBREV_CWT[7] = &quot;cti&quot;; </span>
<span class="fc" id="L768">        ABBREV_CWT[8] = &quot;cnf&quot;; </span>
<span class="fc" id="L769">        ABBREV_CWT[9] = &quot;scope&quot;;</span>
<span class="fc" id="L770">        ABBREV_CWT[38] = &quot;profile&quot;; </span>
<span class="fc" id="L771">        ABBREV_CWT[39] = &quot;cnonce&quot;;</span>
<span class="fc" id="L772">        ABBREV_CWT[40] = &quot;exi&quot;;</span>
<span class="fc" id="L773">        ABBREV_CWT[41] = &quot;rs_cnf&quot;;</span>
    }
    
    /**
     * Type identifier for AS Request Creation Hints abbreviations
     */
    public static final short ABBREV_TYPE_HINTS = 0;
    
    /**
     * Type identifier for Token endpoint parameter abbreviations
     */
    public static final short ABBREV_TYPE_TOKEN = 1;
    
    /**
     * Type identifier for Introspection endpoint parameter abbreviations
     */
    public static final short ABBREV_TYPE_INTROSPECT = 2;
    
    /**
     * Type identifier for CWT claims abbreviations
     */
    public static final short ABBREV_TYPE_CWT = 3;
    
    /**
     * Maps a parameter/claims map to the unabbreviated version.
     * 
     * @param map  the parameter/claims map to decode
     * @param type  the type of parameter/claim map to decode 
     *   (see constants ABBREV_TYPE_*) 
     * 
      * @return  the unabbreviated version of the map
      * @throws AceException  if map is not a CBOR map
     */
    public static Map&lt;String, CBORObject&gt; unabbreviate(
            CBORObject map, short type) throws AceException {                
<span class="nc bnc" id="L808" title="All 2 branches missed.">        if (!map.getType().equals(CBORType.Map)) {</span>
<span class="nc" id="L809">            throw new AceException(&quot;Parameter is not a CBOR map&quot;);</span>
        }
<span class="nc" id="L811">        Map&lt;String, CBORObject&gt; ret = new HashMap&lt;&gt;();</span>

        String[] abbrev;
<span class="nc bnc" id="L814" title="All 4 branches missed.">        switch (type) {</span>
        case ABBREV_TYPE_HINTS:
<span class="nc" id="L816">            abbrev = ABBREV_HINTS;</span>
<span class="nc" id="L817">            break;</span>
        case ABBREV_TYPE_TOKEN:
<span class="nc" id="L819">            abbrev = ABBREV_TOKEN;</span>
<span class="nc" id="L820">            break;</span>
        case ABBREV_TYPE_INTROSPECT:
<span class="nc" id="L822">            abbrev = ABBREV_INTROSPECT;</span>
<span class="nc" id="L823">            break;</span>
        case ABBREV_TYPE_CWT:
        default: 
<span class="nc" id="L826">            abbrev = ABBREV_CWT;</span>
        }

<span class="nc bnc" id="L829" title="All 2 branches missed.">        for (CBORObject key : map.getKeys()) {</span>
<span class="nc" id="L830">            String keyStr = null;</span>
<span class="nc" id="L831">            CBORObject obj = map.get(key);</span>
<span class="nc bnc" id="L832" title="All 4 branches missed.">            if (key.isNumber() &amp;&amp; key.AsNumber().IsInteger()) {</span>
<span class="nc" id="L833">                short keyInt = key.AsNumber().ToInt16Checked();</span>
<span class="nc bnc" id="L834" title="All 4 branches missed.">                if (keyInt &gt; 0 &amp;&amp; keyInt &lt; abbrev.length) {</span>
<span class="nc" id="L835">                   keyStr = abbrev[keyInt];</span>
<span class="nc bnc" id="L836" title="All 2 branches missed.">                    if (keyInt == GRANT_TYPE</span>
<span class="nc bnc" id="L837" title="All 2 branches missed.">                            &amp;&amp; map.get(key).getType().equals(CBORType.Integer)) {</span>
<span class="nc" id="L838">                        obj = CBORObject.FromObject(GRANT_TYPES[obj.AsInt32()]);</span>
<span class="nc bnc" id="L839" title="All 2 branches missed.">                    } else if (keyInt == ERROR</span>
<span class="nc bnc" id="L840" title="All 2 branches missed.">                            &amp;&amp; map.get(key).getType().equals(CBORType.Integer)) {</span>
<span class="nc" id="L841">                        obj = CBORObject.FromObject(ERROR_CODES[obj.AsInt32()]);</span>
                    }                   
                } else {
<span class="nc" id="L844">                    throw new AceException(&quot;Malformed parameter map&quot;);</span>
                }
<span class="nc bnc" id="L846" title="All 2 branches missed.">            } else if (key.getType().equals(CBORType.TextString)) {</span>
<span class="nc" id="L847">                keyStr = key.AsString();</span>
            } else {
<span class="nc" id="L849">                throw new AceException(&quot;Malformed parameter map&quot;);</span>
            }
<span class="nc" id="L851">            ret.put(keyStr, obj);</span>
<span class="nc" id="L852">        }</span>
<span class="nc" id="L853">       return ret;</span>
    }
    
    /**
     * Representation of GET
     */
    public static final short GET = 1;
    
    /**
     *  Representation of POST
     */
    public static final short POST = 2;
    
    /**
     *  Representation of PUT
     */
    public static final short PUT = 3;
    
    /**
     *  Representation of DELETE
     */
    public static final short DELETE = 4;
    
    /**
     * Representation of FETCH
     */
    public static final short FETCH = 5;
    
    /**
     * Representation of PATCH
     */
    public static final short PATCH = 6;
    
    /**
     * Representation of iPATCH
     */
    public static final short iPATCH = 7;
    

    /**
     * Content-Format application/ace+cbor
     */
    public static final int APPLICATION_ACE_CBOR = 19;
    
    /**
     * Content-Format application/cwt
     */
    public static final int APPLICATION_CWT = 61;
    
    /**
     * Content-Format application/ace-groupcomm+cbor
     */
    public static final int APPLICATION_ACE_GROUPCOMM_CBOR = 65001;

    /**
     * Content-Format ace-trl+cbor (2022-15-03, this is a placeholder, the value has TBD)
     */
    public static final int APPLICATION_ACE_TRL_CBOR = 65002;


    /**
     * ACE-TRL+CBOR abbreviations (2022-15-03, these are placeholders, values have TBD)
     */
    public static final short FULL_SET = 1;

    public static final short CURSOR = 2;

    public static final short DIFF_SET = 3;

    public static final short MORE = 4;

    public static final short TRL_ERROR = 5;

    public static final short TRL_ERROR_DESCRIPTION = 6;

    /**
     * Array of the human-readable names for the TRL
     */
<span class="fc" id="L931">    public static String[] ABBREV_TRL = new String[7];</span>
    static {
<span class="fc" id="L933">        ABBREV_TRL[1] = &quot;full-set&quot;;</span>
<span class="fc" id="L934">        ABBREV_TRL[2] = &quot;cursor&quot;;</span>
<span class="fc" id="L935">        ABBREV_TRL[3] = &quot;diff-set&quot;;</span>
<span class="fc" id="L936">        ABBREV_TRL[4] = &quot;more&quot;;</span>
<span class="fc" id="L937">        ABBREV_TRL[5] = &quot;error&quot;;</span>
<span class="fc" id="L938">        ABBREV_TRL[6] = &quot;error_description&quot;;</span>
<span class="fc" id="L939">    }</span>


    /**
     * ACE-TRL+CBOR errors =================================
     */
    public static final short INVALID_PARAMETER_VALUE = 0;

    public static final short INVALID_SET_OF_PARAMETERS = 1;

    public static final short OUT_OF_BOUND_CURSOR_VALUE = 2;

    public static final String INVALID_PARAMETER_VALUE_DESCRIPTION = &quot;Invalid parameter value&quot;;

    public static final String INVALID_SET_OF_PARAMETERS_DESCRIPTION = &quot;Invalid set of parameters&quot;;

    public static final String OUT_OF_BOUND_CURSOR_VALUE_DESCRIPTION = &quot;Out of bound cursor value&quot;;


     /**
      * COSE Header Parameters
      * https://www.iana.org/assignments/cose/cose.xhtml
      */
     public static final int COSE_HEADER_PARAM_X5CHAIN = 33;
     public static final int COSE_HEADER_PARAM_CWT = 36;
     public static final int COSE_HEADER_PARAM_CCS = 37;
     
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.10.202304240956</span></div></body></html>